extends layout

block single_head
    script(src="/js/inventory.js" defer)
    script(src="/js/tables.js" defer)

block main
    - let inventory_table_id = "inventory-table";
    - let edit_item_modal_id = "edit_item";
    - let add_item_modal_id = "add_item";
    - let existing_items = inventory.map(item => `'${item.name}'`).join(", ");

    h1 Inventar
    p Obs: Dersom du redigerer eller legger til elementer er det lurt √• oppdatere siden, da det kan v√¶re at noe ikke fungerer som det skal.

    a(onclick=`resetAddItemModal(); openModal('${add_item_modal_id}')`) Legg til nytt inventar

    br
    br

    input(type="text" placeholder="S√∏k i inventar" id="search" oninput=`searchTable(this.value, "${inventory_table_id}");`)

    table#sort-options--table
        tr
            th
                button(onclick=`toggleColumnVisibility(1, this, "${inventory_table_id}");`) Beskrivelse
            th
                button(onclick=`toggleColumnVisibility(2, this, "${inventory_table_id}");`) Kategori
            th
                button(onclick=`toggleColumnVisibility(3, this, "${inventory_table_id}");`) Sist l√•nt

    table(id=`${inventory_table_id}`)
        thead
            tr
                th
                    a(onclick=`sortTable(0, "${inventory_table_id}")`) ID
                th
                    a(onclick=`sortTable(1, "${inventory_table_id}")`) Beskrivelse
                th
                    a(onclick=`sortTable(2, "${inventory_table_id}")`) Kategori
                th
                    a(onclick=`sortTable(3, "${inventory_table_id}")`) Sist l√•nt
                th
                    a(onclick=`sortTable(4, "${inventory_table_id}")`) Rediger
        tbody
            if !inventory
                tr
                    td Her var det helt tomt üò¢
                    td
                    td
                    td
                    td
            else
                for item in inventory
                    tr
                        td= item.name
                        td= item.description
                        td= item.category
                        td
                            if item.last_borrowed
                                = `${item.last_borrowed.name} (${item.last_borrowed.classroom}) - ${new Date(item.last_borrowed.date).toLocaleDateString(locale, {year: "numeric", month: "long", day: "numeric"})}`
                            else
                                = "Aldri"
                        td
                            a(onclick=`updateEditItemModal("${item.name}","${item.description}","${item.category}"); openModal('${edit_item_modal_id}');`) Rediger
                            if !item.available
                                a(href="#" + item.id) &nbsp;|&nbsp;Levert

    center
        p#search_results_text

    .modal(id=`${add_item_modal_id}`)
        include modals/add_item
    .modal(id=`${edit_item_modal_id}`)
        include modals/edit_item

    // Sort table on page load
    script
        != `window.onload = function (){`
        != `sortTable(0, "${inventory_table_id}");`
        != `updateResultsCounter("#${inventory_table_id} tr");`
        != `}`