{% extends 'layout.html' %}

{% block extra_head %}
{% include 'templates/chosen.html' %}
{% endblock %}

{% block content %}
<hgroup>
    <h1>Legg til nytt inventar</h1>
    <h2>Her kan du legge til nytt inventar. Legg gjerne til flere, så forlater du bare siden når du er ferdig</h2>
</hgroup>

<form>
    <label for="id">Løpenummer</label>
    <input type="text" name="id" id="id" placeholder="Eksempel: A6500-01" required
           pattern="^[^\s][ÆØÅæøåa-zA-Z0-9_\s\-]+[^\s]">

    <label for="name">Navn</label>
    <input type="text" name="name" id="name" placeholder="Eksempel: Sony A6500" required
           pattern="^[^\s][ÆØÅæøåa-zA-Z0-9_\s\-]+[^\s]">

    <label for="category">Kategori</label>
    <select name="category" id="category" required>
        <option value=""></option>
        {% for category in categories %}
        <option value="{{ category }}">{{ category }}</option>
        {% endfor %}
    </select>

    <!--
    <label for="included_batteries">Batterier</label>
    <input type="number" name="included_batteries" id="included_batteries" required value="0" min="0" max="9">
    -->

    <table>
        <thead>
        <th colspan="2">Utskrift</th>
        </thead>
        <td>
            <label for="print_label_count">Antall etiketter</label>
            <input type="number" name="print_label_count" id="print_label_count" required value="1" min="0" max="9">
        </td>
        <td>
            <label for="print_label_type">Type</label>
            <select name="print_label_type" id="print_label_type" required>
                <option value="qr">QR</option>
                <option value="barcode">Strekkode</option>
            </select>
        </td>
    </table>

    <button type="submit">Legg til</button>
</form>

<p id="status">Klar til å legge til gjenstander</p>
<p id="print-status"></p>

<a href="{{ url_for('inventar') }}">
    <button>Ferdig!</button>
</a>

<script>
  $(document).ready(function () {
    $('#category').chosen({
      no_results_text: 'Fant ingen kategorier med det navnet',
      placeholder_text_single: 'Velg kategori'
    });

    $('form').submit(function (event) {
      event.preventDefault();
      $.ajax({
        type: 'POST',
        url: '{{ url_for("api.add_item") }}',
        data: $('form').serialize(),
        success: function (response) {
          $('#status').html(response);
          $('#status').css('color', 'green');
        },
        error: function (response) {
          $('#status').html(response.responseText);
          $('#status').css('color', 'red');
        }
      });

      if ($('#print_label_count').val() > 0) {
        url = '{{ url_for("api.print_label", item_id="REPLACE_ME") }}';
        url = url.replace('REPLACE_ME', $('#id').val());
        $.ajax({
          type: 'POST',
          url: url,
          data: $('form').serialize(),
          success: function (response) {
            $('#print-status').html(response);
            $('#print-status').css('color', 'green');
          },
          error: function (response) {
            $('#print-status').html(response.responseText);
            $('#print-status').css('color', 'red');
          }
        });
      }
    });
  });
</script>

{% endblock %}
